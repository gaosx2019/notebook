"use strict";(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[8595],{3905:(e,n,r)=>{r.d(n,{Zo:()=>i,kt:()=>f});var t=r(7294);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function c(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function a(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?c(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function u(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},c=Object.keys(e);for(t=0;t<c.length;t++)r=c[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(t=0;t<c.length;t++)r=c[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=t.createContext({}),g=function(e){var n=t.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):a(a({},n),e)),r},i=function(e){var n=g(e.components);return t.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},s=t.forwardRef((function(e,n){var r=e.components,o=e.mdxType,c=e.originalType,l=e.parentName,i=u(e,["components","mdxType","originalType","parentName"]),s=g(r),f=o,m=s["".concat(l,".").concat(f)]||s[f]||p[f]||c;return r?t.createElement(m,a(a({ref:n},i),{},{components:r})):t.createElement(m,a({ref:n},i))}));function f(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var c=r.length,a=new Array(c);a[0]=s;var u={};for(var l in n)hasOwnProperty.call(n,l)&&(u[l]=n[l]);u.originalType=e,u.mdxType="string"==typeof e?e:o,a[1]=u;for(var g=2;g<c;g++)a[g]=r[g];return t.createElement.apply(null,a)}return t.createElement.apply(null,r)}s.displayName="MDXCreateElement"},2899:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>c,metadata:()=>u,toc:()=>g});var t=r(7462),o=(r(7294),r(3905));const c={sidebar_position:8},a="\u7ec3\u4e60\uff1aWeb \u722c\u866b",u={unversionedId:"a-tour-of-go/concurrency/concurrency/exercise-web-crawler",id:"a-tour-of-go/concurrency/concurrency/exercise-web-crawler",title:"\u7ec3\u4e60\uff1aWeb \u722c\u866b",description:"\u5728\u8fd9\u4e2a\u7ec3\u4e60\u4e2d\uff0c\u6211\u4eec\u5c06\u4f1a\u4f7f\u7528 Go \u7684\u5e76\u53d1\u7279\u6027\u6765\u5e76\u884c\u5316\u4e00\u4e2a Web \u722c\u866b\u3002",source:"@site/docs/a-tour-of-go/concurrency/concurrency/exercise-web-crawler.md",sourceDirName:"a-tour-of-go/concurrency/concurrency",slug:"/a-tour-of-go/concurrency/concurrency/exercise-web-crawler",permalink:"/notebook/docs/a-tour-of-go/concurrency/concurrency/exercise-web-crawler",draft:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"sync.Mutex",permalink:"/notebook/docs/a-tour-of-go/concurrency/concurrency/mutex-counter"},next:{title:"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u5f00\u53d1\u6307\u5357",permalink:"/notebook/docs/category/\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u5f00\u53d1\u6307\u5357"}},l={},g=[],i={toc:g};function p(e){let{components:n,...r}=e;return(0,o.kt)("wrapper",(0,t.Z)({},i,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"\u7ec3\u4e60web-\u722c\u866b"},"\u7ec3\u4e60\uff1aWeb \u722c\u866b"),(0,o.kt)("p",null,"\u5728\u8fd9\u4e2a\u7ec3\u4e60\u4e2d\uff0c\u6211\u4eec\u5c06\u4f1a\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"Go")," \u7684\u5e76\u53d1\u7279\u6027\u6765\u5e76\u884c\u5316\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"p"},"Web")," \u722c\u866b\u3002"),(0,o.kt)("p",null,"\u4fee\u6539 ",(0,o.kt)("inlineCode",{parentName:"p"},"Crawl")," \u51fd\u6570\u6765\u5e76\u884c\u5730\u6293\u53d6 ",(0,o.kt)("inlineCode",{parentName:"p"},"URL"),"\uff0c\u5e76\u4e14\u4fdd\u8bc1\u4e0d\u91cd\u590d\u3002"),(0,o.kt)("p",null,"\u63d0\u793a\uff1a\u4f60\u53ef\u4ee5\u7528\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"p"},"map")," \u6765\u7f13\u5b58\u5df2\u7ecf\u83b7\u53d6\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"URL"),"\uff0c\u4f46\u662f\u8981\u6ce8\u610f ",(0,o.kt)("inlineCode",{parentName:"p"},"map")," \u672c\u8eab\u5e76\u4e0d\u662f\u5e76\u53d1\u5b89\u5168\u7684\uff01"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"exercise-web-crawler.go")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "fmt"\n    "sync"\n    "time"\n)\n\ntype SafeCounter struct {\n    v   map[string]int\n    mux sync.Mutex\n}\n\n// Inc \u589e\u52a0\u7ed9\u5b9a key \u7684\u8ba1\u6570\u5668\u7684\u503c\u3002\nfunc (c *SafeCounter) Inc(key string) {\n    c.mux.Lock()\n    // Lock \u4e4b\u540e\u540c\u4e00\u65f6\u523b\u53ea\u6709\u4e00\u4e2a goroutine \u80fd\u8bbf\u95ee c.v\n    c.v[key]++\n    c.mux.Unlock()\n}\n\n// Value \u8fd4\u56de\u7ed9\u5b9a key \u7684\u8ba1\u6570\u5668\u7684\u5f53\u524d\u503c\u3002\nfunc (c *SafeCounter) Value(key string) int {\n    c.mux.Lock()\n    // Lock \u4e4b\u540e\u540c\u4e00\u65f6\u523b\u53ea\u6709\u4e00\u4e2a goroutine \u80fd\u8bbf\u95ee c.v\n    defer c.mux.Unlock()\n    return c.v[key]\n}\n\ntype Fetcher interface {\n    // Fetch \u8fd4\u56de URL \u7684 body \u5185\u5bb9\uff0c\u5e76\u4e14\u5c06\u5728\u8fd9\u4e2a\u9875\u9762\u4e0a\u627e\u5230\u7684 URL \u653e\u5230\u4e00\u4e2a slice \u4e2d\u3002\n    Fetch(url string) (body string, urls []string, err error)\n}\n\nvar c SafeCounter = SafeCounter{v: make(map[string]int)}\n\n// Crawl \u4f7f\u7528 fetcher \u4ece\u67d0\u4e2a URL \u5f00\u59cb\u9012\u5f52\u7684\u722c\u53d6\u9875\u9762\uff0c\u76f4\u5230\u8fbe\u5230\u6700\u5927\u6df1\u5ea6\u3002\nfunc Crawl(url string, depth int, fetcher Fetcher) {\n    if depth <= 0 || c.Value(url) == 1 {\n        return\n    }\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf("found: %s %q\\n", url, body)\n    c.Inc(url)\n    for _, u := range urls {\n        go Crawl(u, depth-1, fetcher)\n    }\n    return\n}\n\nfunc main() {\n    Crawl("https://golang.org/", 4, fetcher)\n    time.Sleep(time.Second)\n}\n\n// fakeFetcher \u662f\u8fd4\u56de\u82e5\u5e72\u7ed3\u679c\u7684 Fetcher\u3002\ntype fakeFetcher map[string]*fakeResult\n\ntype fakeResult struct {\n    body string\n    urls []string\n}\n\nfunc (f fakeFetcher) Fetch(url string) (string, []string, error) {\n    if res, ok := f[url]; ok {\n        return res.body, res.urls, nil\n    }\n    return "", nil, fmt.Errorf("not found: %s", url)\n}\n\n// fetcher \u662f\u586b\u5145\u540e\u7684 fakeFetcher\u3002\nvar fetcher = fakeFetcher{\n    "https://golang.org/": &fakeResult{\n        "The Go Programming Language",\n        []string{\n            "https://golang.org/pkg/",\n            "https://golang.org/cmd/",\n        },\n    },\n    "https://golang.org/pkg/": &fakeResult{\n        "Packages",\n        []string{\n            "https://golang.org/",\n            "https://golang.org/cmd/",\n            "https://golang.org/pkg/fmt/",\n            "https://golang.org/pkg/os/",\n        },\n    },\n    "https://golang.org/pkg/fmt/": &fakeResult{\n        "Package fmt",\n        []string{\n            "https://golang.org/",\n            "https://golang.org/pkg/",\n        },\n    },\n    "https://golang.org/pkg/os/": &fakeResult{\n        "Package os",\n        []string{\n            "https://golang.org/",\n            "https://golang.org/pkg/",\n        },\n    },\n}\n')),(0,o.kt)("p",null,"\u8f93\u51fa\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'found: https://golang.org/ "The Go Programming Language"\nfound: https://golang.org/pkg/ "Packages"\nfound: https://golang.org/pkg/os/ "Package os"\nfound: https://golang.org/pkg/fmt/ "Package fmt"\nnot found: https://golang.org/cmd/\nnot found: https://golang.org/cmd/\n')))}p.isMDXComponent=!0}}]);